# 濠鮮資料庫測試案例

## 1. 客戶管理測試 (customers)

### 1.1 客戶註冊測試
- [x] 新客戶註冊（所有欄位皆正確填寫）  
  **範例**：  
  ```json
  {
    "line_id": "U123456789",
    "line_name": "John Doe",
    "line_pic_url": "https://example.com/avatar.jpg",
    "phone": "0912345678",
    "email": "john.doe@example.com",
    "address": "台北市信義區松仁路123號",
    "create_date": "2025-03-06T22:16:37+08:00"
  }
  ```

- [x] 重複的 LINE ID 註冊  
  **範例**：使用已存在的 `line_id` 進行註冊

- [x] 無效的電子郵件格式  
  **範例**：`email` 欄位為 `"john.doe"`

### 1.2 客戶資料更新測試
- [x] 更新客戶聯絡資訊（電話、地址）  
  **範例**：  
  ```json
  {
    "phone": "0987654321",
    "address": "台北市大安區忠孝東路456號"
  }
  ```



## 2. 商品管理測試 (products)

### 2.1 商品基本操作測試
- [x] 新增商品（包含所有必填欄位）  
  **範例**：  
  ```json
  {
    "product_id": 1,
    "product_name": "濠鮮特製海鮮拼盤",
    "price": 1200.00,
    "stock_quantity": 50,
    "description": "包含多種新鮮海鮮，適合4-6人享用",
    "create_time": "2025-03-06T22:16:37+08:00"
  }
  ```

- [x] 設定特價（特價必須低於原價）  
  **範例**：`specail_price` 設為 `1000.00`

- [x] 庫存數量更新  
  **範例**：`stock_quantity` 從 `50` 更新為 `30`

- [x] 商品資訊修改  
  **範例**：更新 `description` 為新的描述


### 2.2 商品類別關聯測試
- [x] 將商品加入多個類別  
  **範例**：將 `product_id` 為 `1` 的商品加入 `category_id` 為 `2` 和 `3` 的類別

- [x] 移除商品的類別關聯  
  **範例**：移除 `product_id` 為 `1` 的商品與 `category_id` 為 `2` 的關聯

- [x] 刪除已有商品的類別處理  
  **範例**：刪除 `category_id` 為 `2` 的類別，並確認相關商品關聯被移除

## 3. 訂單處理測試 (orders & order_details)

### 3.1 訂單建立測試
- [x] 正常訂單建立流程  
  **範例**：建立包含多個商品的訂單，並確認總金額計算正確

- [x] 庫存不足時的訂單處理  
  **範例**：嘗試建立超出庫存的訂單，應返回錯誤

- [x] 訂單總金額計算  
  **範例**：確認訂單中各項商品金額加總正確

- [x] 多項商品訂單  
  **範例**：建立包含不同商品的訂單，並確認各項商品數量和單價

- [x] 特價商品訂單  
  **範例**：建立包含特價商品的訂單，並確認特價計算正確

### 3.2 訂單狀態測試

- [x] 無效的狀態轉換  
  **範例**：嘗試將訂單狀態從 "已完成" 變更回 "已下單"

- [x] 訂單取消處理  
  **範例**：取消訂單後確認庫存回補

### 3.3 訂單明細測試
- [x] 新增訂單項目  
  **範例**：在現有訂單中新增商品項目，並確認小計更新

- [x] 修改訂單數量  
  **範例**：更新訂單中某商品的數量，並確認小計變更

- [x] 刪除訂單項目  
  **範例**：從訂單中移除商品，並確認總金額更新

- [x] 小計金額計算  
  **範例**：確認每項訂單明細的小計計算正確

## 4. 整合測試案例

### 4.1 庫存管理整合測試
- [x] 訂單成立後庫存自動扣減  
  **範例**：確認訂單建立後商品庫存減少

- [x] 訂單取消後庫存回補  
  **範例**：取消訂單後確認商品庫存恢復

- [x] 多筆訂單同時處理庫存  
  **範例**：同時建立多筆訂單，確認庫存正確更新
  ```json
  {
    "line_id": "U123456789",
    "details": [
      {
        "product_id": 1,
        "quantity": 3
      }
    ]
  }
  ```

### 4.2 金額計算整合測試
- [x] 混合一般商品和特價商品的訂單總金額  
  **範例**：確認訂單中包含特價商品時的總金額計算
  ```json
  {
    "line_id": "U123456789",
    "details": [
      {
        "product_id": 1,  // 一般商品
        "quantity": 2
      },
      {
        "product_id": 2,  // 特價商品
        "quantity": 2
      }
    ]
  }
  ```

- [x] 訂單明細金額加總  
  **範例**：確認所有訂單明細的小計加總等於訂單總金額

### 4.3 資料完整性測試
- [x] 刪除商品時相關訂單和照片的處理  
  **範例**：刪除商品後確認相關訂單和照片的處理
  ```json
  {
    "order_id": 1,
    "details": [
      {
        "product_id": 1,
        "product_deleted": true
      }
    ]
  }
  ```

- [x] 刪除類別時的商品關聯處理  
  **範例**：刪除類別後確認商品的類別關聯被移除
  ```json
  {
    "product_id": 1,
    "categories": []  // 原有的類別關聯被移除
  }
  ```

- [x] 客戶資料刪除時的訂單處理  
  **範例**：刪除客戶資料後確認相關訂單的處理
  ```json
  {
    "order_id": 1,
    "customer_deleted": true
  }
  ```

- [x] 商品照片和分類的關聯處理  
  **範例**：測試商品照片和分類的完整關聯
  ```json
  {
    "product_id": 1,
    "categories": [
      {
        "category_id": 1,
        "category_name": "海鮮"
      },
      {
        "category_id": 2,
        "category_name": "熟食"
      }
    ],
    "photos": [
      {
        "photo_id": 1,
        "photo_url": "https://example.com/photo1.jpg",
        "is_main": true,
        "sort_order": 1
      },
      {
        "photo_id": 2,
        "photo_url": "https://example.com/photo2.jpg",
        "is_main": false,
        "sort_order": 2
      }
    ]
  }
  ```

## 5. 效能測試案例

### 5.1 查詢效能測試
- [x] 大量訂單查詢效能  
  **範例**：測試查詢大量訂單時的效能

- [x] 商品搜尋效能  
  **範例**：測試商品搜尋的速度和準確性

- [x] 類別篩選效能  
  **範例**：測試使用類別篩選商品時的效能

### 5.2 並發處理測試
- [x] 多用戶同時下單  
  **範例**：模擬多用戶同時下單，確認系統穩定性

- [x] 庫存並發更新  
  **範例**：測試多用戶同時更新庫存的情況

- [x] 訂單狀態並發修改  
  **範例**：測試多用戶同時修改訂單狀態的情況

## 6. 安全性測試

### 6.1 資料驗證測試
- [x] SQL 注入防護  
  **範例**：測試系統對 SQL 注入攻擊的防護能力

- [x] 特殊字符處理  
  **範例**：測試系統對特殊字符的處理能力

- [x] 資料越權存取  
  **範例**：測試未授權用戶嘗試存取敏感資料的情況

### 6.2 權限控制測試
- [x] 客戶只能存取自己的訂單  
  **範例**：測試客戶無法存取其他客戶的訂單

- [x] 未授權的資料修改請求  
  **範例**：測試未授權用戶嘗試修改資料的情況

- [x] 敏感資料存取控制  
  **範例**：測試對敏感資料的存取控制

## 建議的測試優先順序

1. 基本 CRUD 操作測試（客戶、商品、訂單）
2. 業務邏輯測試（訂單流程、庫存管理）
3. 資料完整性測試
4. 效能測試
5. 安全性測試

## 測試資料準備建議

1. 準備基礎測試資料集
   - 多個測試客戶帳號
   - 不同類別的商品
   - 各種狀態的訂單

2. 準備邊界條件測試資料
   - 庫存為零的商品
   - 特價等於原價的商品
   - 大量訂單資料

3. 準備異常測試資料
   - 無效的 URL
   - 異常的金額數值
   - 不合法的狀態值
